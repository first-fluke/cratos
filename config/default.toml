# Cratos Default Configuration
# Copy to config/local.toml and customize for your environment
#
# ============================================================================
# SECURITY WARNING
# ============================================================================
# This is a DEVELOPMENT configuration with default credentials.
# DO NOT use these values in production!
#
# For production deployments:
# 1. Create config/production.toml with secure credentials
# 2. Set CRATOS_ENV=production
# 3. Use environment variables for sensitive data (API keys, passwords)
# 4. Ensure database and Redis use authentication
# 5. Bind server to 127.0.0.1 or use a reverse proxy
# ============================================================================

[server]
# SECURITY: In production, consider binding to 127.0.0.1 and using a reverse proxy
host = "127.0.0.1"
port = 19527

# Data directory for SQLite database and other local storage
# Default: ~/.cratos (or platform-specific data directory)
# data_dir = "~/.cratos"

# Note: PostgreSQL is no longer required. Cratos uses embedded SQLite.
# The database file will be created at: {data_dir}/cratos.db

[redis]
# SECURITY: Enable Redis AUTH in production
# When using docker-compose, use port 63791
url = "redis://localhost:6379"

[llm]
# Auto-detect provider from environment variables
# Priority: groq (free) > openrouter > novita > deepseek > openai > anthropic
# Or explicitly set: "openai", "anthropic", "groq", "deepseek", "openrouter", "novita", "ollama"
default_provider = "auto"

# ============================================================================
# Model Routing Configuration (Cost Optimization)
# ============================================================================
#
# Cratos uses tiered routing to minimize costs:
# - Simple tasks: FREE tier (Groq) - $0/month
# - General tasks: Low-cost (DeepSeek) - ~$0.14/1M tokens
# - Complex tasks: Premium (Anthropic) - Higher cost, better quality
#
# Cost comparison per 1M tokens (Feb 2026):
# | Provider   | Model                    | Input    | Output   |
# |------------|--------------------------|----------|----------|
# | Groq       | llama-3.1-8b-instant     | $0.05    | $0.08    |
# | GPT-5 nano | gpt-5-nano               | $0.05    | $0.40    |
# | DeepSeek   | deepseek-chat            | $0.14    | $0.28    |
# | GPT-5      | gpt-5                    | $1.25    | $10.00   |
# | Anthropic  | claude-sonnet-4-5        | $3.00    | $15.00   |
# | Anthropic  | claude-opus-4-5          | $5.00    | $25.00   |

[llm.model_routing]
# Simple tasks (classification, extraction): Ultra-low-cost
simple = { provider = "groq", model = "openai/gpt-oss-20b" }
# General tasks (conversation, summarization): Low-cost
general = { provider = "deepseek", model = "deepseek-chat" }
# Complex tasks (planning, code generation): Premium
complex = { provider = "anthropic", model = "claude-sonnet-4-5-20250929" }
# Fallback when primary provider fails
fallback = { provider = "openai", model = "gpt-5-nano" }
# Automatically downgrade on rate limits
auto_downgrade = true

# ============================================================================
# Provider Configurations
# ============================================================================

[llm.groq]
# Groq ultra-fast inference - API key from GROQ_API_KEY env var
# Free tier available (rate-limited), paid per token
base_url = "https://api.groq.com/openai/v1"
default_model = "llama-3.3-70b-versatile"
timeout_ms = 60000

[llm.deepseek]
# DeepSeek ultra-low-cost - API key from DEEPSEEK_API_KEY env var
# $0.14/1M input, $0.28/1M output (95%+ cheaper than GPT-5)
base_url = "https://api.deepseek.com/v1"
default_model = "deepseek-chat"
timeout_ms = 120000

[llm.openai]
# API key loaded from OPENAI_API_KEY environment variable
# GPT-5 is cheaper than GPT-4o ($1.25 vs $2.50 per 1M input tokens)
default_model = "gpt-5"
timeout_ms = 60000

[llm.anthropic]
# API key loaded from ANTHROPIC_API_KEY environment variable
default_model = "claude-sonnet-4-5-20250929"
timeout_ms = 120000

[llm.gemini]
# API key loaded from GOOGLE_API_KEY environment variable
default_model = "gemini-2.5-flash"
timeout_ms = 60000

[llm.ollama]
# Local Ollama instance
# Note: llama3.2 (3B) is too small for tool calling. Use 7B+ models.
base_url = "http://localhost:11434"
default_model = "qwen2.5:7b"
timeout_ms = 300000

[llm.glm]
# ZhipuAI GLM API - API key from ZHIPU_API_KEY env var
base_url = "https://open.bigmodel.cn/api/paas/v4"
default_model = "glm-4-9b"
timeout_ms = 60000

[llm.qwen]
# Alibaba Qwen/DashScope API - API key from DASHSCOPE_API_KEY env var
base_url = "https://dashscope.aliyuncs.com/compatible-mode/v1"
default_model = "qwen-turbo"
timeout_ms = 60000

[llm.openrouter]
# OpenRouter multi-provider gateway - API key from OPENROUTER_API_KEY env var
# WARNING: Free models (:free suffix) are queue-based, very slow, and unreliable for tool calling.
# Use paid models for production. Cheapest usable: google/gemini-flash-1.5 (~$0.075/M)
base_url = "https://openrouter.ai/api/v1"
default_model = "google/gemini-flash-1.5"
timeout_ms = 60000

[llm.novita]
# Novita AI free tier - API key from NOVITA_API_KEY env var (free signup)
# Free models: Llama 3.2 1B/3B, Qwen2.5-7B, GLM-4-9B, GLM-Z1-9B
base_url = "https://api.novita.ai/v3/openai"
default_model = "qwen/qwen2.5-7b-instruct"
timeout_ms = 120000

[llm.routing]
# Legacy task-based model selection (deprecated, use model_routing instead)
classification = "groq:llama-3.3-70b-versatile"
planning = "anthropic:claude-sonnet-4-5-20250929"
code_generation = "anthropic:claude-sonnet-4-5-20250929"
summarization = "groq:llama-3.3-70b-versatile"

# ============================================================================
# Olympus OS Configuration
# ============================================================================

[olympus]
# Enable law enforcement validation on responses
enforcement_enabled = true
# Auto-apply silence punishment on violations (conservative default: off)
auto_silence = false
# Auto-add judgment entries on violations
auto_judgment = true
# Auto-log chronicle entries after task execution
auto_chronicle = true
# Auto-check promotion eligibility after chronicle logging
auto_promotion = true

# ============================================================================
# Security Configuration
# ============================================================================

# ============================================================================
# Authentication & Rate Limiting
# ============================================================================

[server.auth]
# Enable authentication for HTTP/WS endpoints
# false = all endpoints open (development only)
# true = require Bearer token or X-API-Key
enabled = false

# Auto-generate an admin API key on first run (printed to stdout)
auto_generate_key = true

# Where to store API keys: "keychain" | "encrypted_file" | "memory"
key_storage = "keychain"

[server.rate_limit]
# Enable rate limiting
enabled = true
# REST requests per minute per token/IP
requests_per_minute = 60
# WebSocket messages per minute per connection
ws_messages_per_minute = 120
# Maximum WebSocket message size in bytes (1MB)
max_ws_message_bytes = 1048576
# Global requests per minute (all users combined)
global_requests_per_minute = 1000

[security]
# Sandbox policy: strict | moderate | disabled
# - strict: All tool executions sandboxed
# - moderate: Only dangerous tools sandboxed (default)
# - disabled: No sandboxing (development only)
sandbox_policy = "moderate"

# Credential storage backend: auto | keychain | secret_service | encrypted_file
# - auto: Detect best backend for platform (recommended)
# - keychain: macOS Keychain
# - secret_service: Linux Secret Service (GNOME Keyring)
# - encrypted_file: AES-256 encrypted file (fallback)
credential_backend = "auto"

# Enable prompt injection detection
enable_injection_protection = true

# ── Exec Tool Security ──
# Controls which shell commands the AI assistant can run.
[security.exec]
# "permissive" — Block only dangerous commands (rm, sudo, etc.). Best for personal machine.
# "strict" — Block ALL commands except those in allowed_commands list.
mode = "permissive"

# Maximum command timeout in seconds
max_timeout_secs = 60

# Additional commands to block (added to built-in blocklist: rm, sudo, dd, etc.)
extra_blocked_commands = []

# Commands allowed when mode = "strict" (ignored in permissive mode)
# Example: ["ls", "cat", "grep", "git", "cargo", "osascript", "sqlite3"]
allowed_commands = []

# Blocked filesystem paths (commands cannot access these as arguments or cwd)
blocked_paths = [
    "/etc", "/root", "/var/log", "/boot",
    "/dev", "/proc", "/sys",
    "/usr/bin", "/usr/sbin", "/bin", "/sbin",
]

[security.sandbox]
# Default network mode for sandboxed containers: none | bridge | host
# - none: No network access (most secure, default)
# - bridge: Isolated network
# - host: Host network (not recommended)
default_network = "none"

# Resource limits for sandboxed containers
max_memory_mb = 512
max_cpu_percent = 50
max_pids = 100
timeout_seconds = 60

[security.injection]
# Minimum threat level to block: info | low | medium | high | critical
block_threshold = "medium"

# Maximum input/output lengths (characters)
max_input_length = 100000
max_output_length = 1000000

[approval]
# Approval mode: always | risky_only | never
# "never" = auto-approve all tools (recommended for local/personal use)
# "risky_only" = block high-risk tools (exec, browser) unless approved
default_mode = "never"

[replay]
# Event log retention in days
retention_days = 30
# Maximum events per execution
max_events_per_execution = 1000

[channels.telegram]
enabled = true
# Token loaded from TELEGRAM_BOT_TOKEN environment variable

[channels.slack]
enabled = false
# Tokens loaded from SLACK_BOT_TOKEN and SLACK_SIGNING_SECRET environment variables

# ============================================================================
# Discord Configuration
# ============================================================================
[channels.discord]
enabled = false
# Token loaded from DISCORD_BOT_TOKEN environment variable
# require_mention = true       # Require @bot mention in guild channels
# allowed_guilds = []          # Empty = allow all
# allowed_channels = []        # Empty = allow all

# ============================================================================
# Matrix Configuration
# ============================================================================
[channels.matrix]
enabled = false
# Environment variables required:
# MATRIX_HOMESERVER_URL - e.g., "https://matrix.org"
# MATRIX_USER_ID - e.g., "@bot:matrix.org"
# MATRIX_PASSWORD - Bot account password
# MATRIX_ALLOWED_ROOMS - Comma-separated room IDs (optional, empty = allow all)

# ============================================================================
# WhatsApp Configuration (Baileys - Unofficial)
# ============================================================================
# WARNING: Baileys uses reverse-engineered WhatsApp Web protocol
# - Account BAN risk exists
# - Violates Meta Terms of Service
# - Do NOT use with important accounts
# - For business: use WhatsApp Business API instead
[channels.whatsapp]
enabled = false
bridge_url = "http://localhost:3001"
# allowed_numbers = []         # Empty = allow all

# ============================================================================
# WhatsApp Business API (Official)
# ============================================================================
[channels.whatsapp_business]
enabled = false
# Credentials loaded from environment variables:
# - WHATSAPP_ACCESS_TOKEN
# - WHATSAPP_PHONE_NUMBER_ID
# - WHATSAPP_BUSINESS_ACCOUNT_ID
# - WHATSAPP_WEBHOOK_VERIFY_TOKEN

# ============================================================================
# Voice Control Configuration
# ============================================================================
[voice]
enabled = false
language = "ko"               # "ko" | "en" | "ja" | "zh"
threshold = 0.5               # Voice detection threshold (0.0 - 1.0)
silence_duration_ms = 1500    # Silence duration to stop listening
max_duration_secs = 30        # Maximum recording duration

# Wake Word - customize the assistant name!
# Default: "크레토스" (Korean), can be anything you want
[voice.wake_word]
name = "크레토스"
alternatives = ["크레토스", "Hey Cratos"]
# sensitivity = 0.5

# TTS Voice Selection
# Korean: ko-KR-SunHiNeural, ko-KR-InJoonNeural, ko-KR-YuJinNeural
# English: en-US-JennyNeural, en-US-GuyNeural, en-GB-SoniaNeural
[voice.tts]
# voice = "ko-KR-SunHiNeural"

# STT (Speech-to-Text) Configuration
# Backend: "auto" | "api" | "local"
#   auto  = local Whisper first, API fallback (recommended)
#   api   = OpenAI Whisper API only (requires OPENAI_API_KEY, ~$0.006/min)
#   local = Local Whisper via candle (free, requires local-stt feature)
# Model: "tiny" | "base" | "small"
#   Korean requires "small" for reasonable accuracy (~85%)
[voice.stt]
backend = "auto"
model = "small"

# TTS (Edge TTS) is always free - no API key needed

# ============================================================================
# Vector Search Configuration (Semantic Search)
# ============================================================================

[vector_search]
# Enable vector search for semantic skill routing and execution history search
# Requires ~100MB model download on first run (fastembed nomic-embed-text-v1.5)
enabled = true

# Embedding dimensions (768 for nomic-embed-text-v1.5)
# Do not change unless using a different model
dimensions = 768

# ============================================================================
# Browser Automation Configuration
# ============================================================================
# Requires: npm install -g @anthropic-ai/mcp-server-playwright
# Or:       npm install -g @anthropic-ai/mcp-server-puppeteer

[browser]
enabled = true
default_engine = "playwright"  # "playwright" or "puppeteer"

[browser.playwright]
browser_type = "chromium"      # "chromium", "firefox", or "webkit"
headless = true
timeout = 30000                # Default timeout in milliseconds
viewport_width = 1280
viewport_height = 720

# ============================================================================
# Live Canvas Configuration
# ============================================================================

[canvas]
enabled = true
max_sessions = 100             # Maximum concurrent sessions

[canvas.websocket]
heartbeat_interval_secs = 30
max_message_size_kb = 1024

[canvas.ai_streaming]
enabled = true
chunk_size = 20                # Characters per streaming chunk

# ============================================================================
# Wake-on-LAN Configuration
# ============================================================================

[wol]
enabled = true
default_port = 9               # Standard WoL port
broadcast_address = "255.255.255.255"

# Named devices for convenience (optional)
# Use with: "Wake up my desktop" or "wol:desktop"
# [wol.devices]
# desktop = "AA:BB:CC:DD:EE:FF"
# server = "11:22:33:44:55:66"
# nas = "00:11:22:33:44:55"

# ============================================================================
# MCP (Model Context Protocol) Server Configuration
# ============================================================================
# MCP enables Claude to interact with external tools and data sources.
# Server definitions are in .mcp.json at the project root.
# Configure per-server settings here.

[mcp]
# Global MCP enable/disable
enabled = true
# Auto-start configured servers on startup
auto_start = true

# Notion MCP server
# Requires: NOTION_API_KEY environment variable
# Get key from: https://developers.notion.com/
[mcp.servers.notion]
enabled = false
# Optional: limit to specific databases
# allowed_databases = []

# Obsidian MCP server (via filesystem server)
# Requires: OBSIDIAN_VAULT_PATH environment variable
[mcp.servers.obsidian]
enabled = false
vault_path = "~/Documents/Obsidian/MyVault"
# File types to index for semantic search
# index_extensions = ["md", "txt"]

# Playwright browser automation
[mcp.servers.playwright]
enabled = true

# Filesystem access
[mcp.servers.filesystem]
enabled = true
# Root path for filesystem access
root = "~/cratos-workspace"

# ============================================================================
# ProactiveScheduler Configuration (24/7 Task Automation)
# ============================================================================
# Enables automated task execution based on time, events, or conditions.
# Tasks are persisted in SQLite and survive restarts.

[scheduler]
# Enable the scheduler
enabled = true
# Check interval in seconds (how often to look for due tasks)
check_interval_secs = 60
# Default retry delay for failed tasks (seconds)
retry_delay_secs = 30
# Maximum concurrent task executions
max_concurrent = 10
# Enable execution logging
logging_enabled = true

# Example scheduled tasks (uncomment to use)
# [[scheduler.tasks]]
# name = "daily_backup_reminder"
# description = "Send daily backup reminder at 9 AM"
# trigger = { type = "cron", expression = "0 9 * * *" }
# action = { type = "notification", channel = "telegram", channel_id = "YOUR_CHAT_ID", message = "Time to backup!" }
# enabled = true

# [[scheduler.tasks]]
# name = "hourly_health_check"
# description = "Check system health every hour"
# trigger = { type = "interval", seconds = 3600 }
# action = { type = "natural_language", prompt = "Check system health and report any issues" }
# enabled = true

# [[scheduler.tasks]]
# name = "cpu_alert"
# description = "Alert when CPU usage is high for 5 minutes"
# trigger = { type = "system", metric = "cpu_usage", threshold = 90.0, comparison = "greater_than", duration_secs = 300 }
# action = { type = "notification", channel = "telegram", channel_id = "YOUR_CHAT_ID", message = "CPU usage is critically high!" }
# enabled = true
